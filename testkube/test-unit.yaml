apiVersion: testworkflows.testkube.io/v1
kind: TestWorkflow
metadata:
  name: task-manager-unit
  namespace: testkube
  labels:
    app: task-manager
    type: unit
spec:
  content:
    git:
      uri: https://github.com/jonmell78/testkube.git
      revision: main
  container:
    image: node:22-alpine
    workingDir: /data/repo
  steps:
    - name: Install dependencies
      shell: npm ci

    - name: Run unit tests
      shell: npm run test:unit -- --ci --coverage
      env:
        - name: NODE_ENV
          value: test

    - name: Save coverage artifacts
      condition: always
      artifacts:
        paths:
          - coverage/**/*
